/*! sync-async 21-07-2013 */
var SA=function(){"use strict";function e(e,t){var n={},i={scheduled:[],completed:[]};this.start=function(){var c=function(t,c){var r,s=e[t].call(void 0),o=["resolved","terminated","resolved"],u=function(){i.completed.push(i.scheduled.splice(t,1)),n.each&&n.each.call(this,s),e.length===i.completed&&n.then?n.then.call(void 0,i):c.call(void 0)};for(i.scheduled.push(s),r=0;o.length>r;r+=1)s[o[r]]=u},r=function(){var t,n=function(e){setTimeout(function(){c(e)},0)};for(t=0;e.length>t;t+=1)n(t)},s=function(){var e=0,t=function(){c(e+=1,t)};t()};t.async?r():s()},this.stop=function(){var e;for(e=0;i.scheduled>e;e+=1)i.scheduled[e].terminate()},this.listener=function(e,t){var i=t&&t.each?"each":"then";n[i]=e},this.context=function(){return{scheduled:i.scheduled.slice(0),completed:i.completed.slice(0)}}}function t(e){this.after=function(t,n){return setTimeout(function(){n.call(void 0,e.context())},t),this},this.afterEach=function(t){return e.listener(t,{each:!0}),this},this.then=function(t){return e.listener(t),SA}}function n(){var e,t,n={reject:"rejected",resolve:"resolved",terminate:"terminated"},i=[],c=function(t){return function(){e&&e[n[t]]?e[n[t]].apply(void 0,arguments):i.push({name:n[t],args:arguments})}};for(t in n)n.hasOwnProperty(t)&&(this[t]=c(t));this.then=function(t){if(i){var n;for(n=0;i.length>n;n+=1)t[i[n].name].apply(void 0,i[n].args);i=[]}e=t}}this.sync=function(){return new t(new e(arguments))},this.async=function(){return new t(new e(arguments,{async:!0}))},this.promise=function(){return new n}}();